<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>تحليل المبيعات</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
            direction: rtl; /* Set direction to Right-to-Left for Arabic text */
            text-align: right;
        }
        .container {
            max-width: 1200px;
            margin: auto;
            padding: 2rem;
        }
        .card {
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            padding: 2rem;
            margin-bottom: 1.5rem;
        }
        .chart-container {
            position: relative;
            height: 400px;
            width: 100%;
        }
    </style>
</head>
<body class="bg-gray-100">

    <div class="container mx-auto p-6">
        <div class="bg-white rounded-xl shadow-lg p-8 mb-6 text-center">
            <h1 class="text-3xl md:text-4xl font-bold text-gray-800 mb-2">مشروع تحليل المبيعات</h1>
            <p class="text-gray-500 text-lg">تحليل أداء المبيعات لبيانات تجريبية</p>
        </div>

        <!-- Section for Key Metrics -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
            <div class="card flex flex-col items-center">
                <p class="text-gray-500 font-medium">إجمالي المبيعات</p>
                <p id="totalSales" class="text-4xl font-bold text-blue-600 mt-2">--</p>
            </div>
            <div class="card flex flex-col items-center">
                <p class="text-gray-500 font-medium">عدد الطلبات</p>
                <p id="totalOrders" class="text-4xl font-bold text-green-600 mt-2">--</p>
            </div>
            <div class="card flex flex-col items-center">
                <p class="text-gray-500 font-medium">متوسط قيمة الطلب</p>
                <p id="avgOrderValue" class="text-4xl font-bold text-red-600 mt-2">--</p>
            </div>
        </div>

        <!-- Section for Charts and Tables -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            
            <!-- Sales by Category Chart -->
            <div class="card">
                <h2 class="text-xl font-semibold text-gray-700 mb-4">المبيعات حسب الفئة</h2>
                <div class="chart-container">
                    <canvas id="salesByCategoryChart"></canvas>
                </div>
            </div>

            <!-- Sales by Region Chart -->
            <div class="card">
                <h2 class="text-xl font-semibold text-gray-700 mb-4">المبيعات حسب المنطقة</h2>
                <div class="chart-container">
                    <canvas id="salesByRegionChart"></canvas>
                </div>
            </div>

            <!-- New: Monthly Sales Chart -->
            <div class="card">
                <h2 class="text-xl font-semibold text-gray-700 mb-4">المبيعات الشهرية</h2>
                <div class="chart-container">
                    <canvas id="monthlySalesChart"></canvas>
                </div>
            </div>

            <!-- Top 5 Products Table -->
            <div class="card">
                <h2 class="text-xl font-semibold text-gray-700 mb-4">أفضل 5 منتجات من حيث المبيعات</h2>
                <div class="overflow-x-auto">
                    <table class="min-w-full bg-white rounded-xl shadow-sm text-right">
                        <thead>
                            <tr class="bg-gray-200 text-gray-600 uppercase text-sm leading-normal">
                                <th class="py-3 px-6 text-right">المنتج</th>
                                <th class="py-3 px-6 text-right">إجمالي المبيعات</th>
                                <th class="py-3 px-6 text-right">الكمية المباعة</th>
                            </tr>
                        </thead>
                        <tbody id="topProductsTable" class="text-gray-600 text-sm font-light">
                            <!-- Data will be inserted here by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- New: Top Customers Table -->
            <div class="card lg:col-span-2">
                <h2 class="text-xl font-semibold text-gray-700 mb-4">أفضل 5 عملاء</h2>
                <div class="overflow-x-auto">
                    <table class="min-w-full bg-white rounded-xl shadow-sm text-right">
                        <thead>
                            <tr class="bg-gray-200 text-gray-600 uppercase text-sm leading-normal">
                                <th class="py-3 px-6 text-right">اسم العميل</th>
                                <th class="py-3 px-6 text-right">إجمالي الإنفاق</th>
                                <th class="py-3 px-6 text-right">عدد الطلبات</th>
                            </tr>
                        </thead>
                        <tbody id="topCustomersTable" class="text-gray-600 text-sm font-light">
                            <!-- Data will be inserted here by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Chart.js Library -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script>
        // Sample data for analysis
        const salesData = [
            { OrderID: 1, OrderDate: '2023-01-01', CustomerName: 'Ahmed Ali', Region: 'North', Category: 'Laptops', Product: 'Laptop Pro 15"', Quantity: 2, UnitPrice: 1200, TotalSales: 2400 },
            { OrderID: 2, OrderDate: '2023-01-03', CustomerName: 'Fatima Saleh', Region: 'East', Category: 'Phones', Product: 'SmartPhone X', Quantity: 5, UnitPrice: 800, TotalSales: 4000 },
            { OrderID: 3, OrderDate: '2023-01-15', CustomerName: 'Khalid Hasan', Region: 'West', Category: 'Laptops', Product: 'Laptop Air 13"', Quantity: 3, UnitPrice: 950, TotalSales: 2850 },
            { OrderID: 4, OrderDate: '2023-01-20', CustomerName: 'Sara Ibrahim', Region: 'North', Category: 'Phones', Product: 'SmartPhone Y', Quantity: 4, UnitPrice: 650, TotalSales: 2600 },
            { OrderID: 5, OrderDate: '2023-02-05', CustomerName: 'Omar Youssef', Region: 'South', Category: 'Laptops', Product: 'Laptop Pro 15"', Quantity: 1, UnitPrice: 1200, TotalSales: 1200 },
            { OrderID: 6, OrderDate: '2023-02-11', CustomerName: 'Nour Adel', Region: 'East', Category: 'TV', Product: 'Smart TV 55"', Quantity: 3, UnitPrice: 700, TotalSales: 2100 },
            { OrderID: 7, OrderDate: '2023-02-18', CustomerName: 'Ahmed Ali', Region: 'North', Category: 'Phones', Product: 'SmartPhone X', Quantity: 2, UnitPrice: 800, TotalSales: 1600 },
            { OrderID: 8, OrderDate: '2023-02-25', CustomerName: 'Mona Said', Region: 'West', Category: 'TV', Product: 'Smart TV 43"', Quantity: 4, UnitPrice: 450, TotalSales: 1800 },
            { OrderID: 9, OrderDate: '2023-03-02', CustomerName: 'Khalid Hasan', Region: 'West', Category: 'Laptops', Product: 'Laptop Pro 15"', Quantity: 1, UnitPrice: 1200, TotalSales: 1200 },
            { OrderID: 10, OrderDate: '2023-03-08', CustomerName: 'Fatima Saleh', Region: 'East', Category: 'Phones', Product: 'SmartPhone Y', Quantity: 6, UnitPrice: 650, TotalSales: 3900 },
            { OrderID: 11, OrderDate: '2023-03-15', CustomerName: 'Sara Ibrahim', Region: 'North', Category: 'TV', Product: 'Smart TV 55"', Quantity: 2, UnitPrice: 700, TotalSales: 1400 },
            { OrderID: 12, OrderDate: '2023-03-21', CustomerName: 'Omar Youssef', Region: 'South', Category: 'Phones', Product: 'SmartPhone X', Quantity: 3, UnitPrice: 800, TotalSales: 2400 },
            { OrderID: 13, OrderDate: '2023-03-28', CustomerName: 'Ahmed Ali', Region: 'North', Category: 'Laptops', Product: 'Laptop Air 13"', Quantity: 2, UnitPrice: 950, TotalSales: 1900 },
            { OrderID: 14, OrderDate: '2023-04-04', CustomerName: 'Mona Said', Region: 'West', Category: 'TV', Product: 'Smart TV 55"', Quantity: 3, UnitPrice: 700, TotalSales: 2100 },
            { OrderID: 15, OrderDate: '2023-04-12', CustomerName: 'Fatima Saleh', Region: 'East', Category: 'Laptops', Product: 'Laptop Pro 15"', Quantity: 1, UnitPrice: 1200, TotalSales: 1200 }
        ];

        // Function to perform analysis and render data
        function runAnalysis() {
            // 1. Calculate key metrics
            const totalSales = salesData.reduce((sum, item) => sum + item.TotalSales, 0);
            const totalOrders = salesData.length;
            const avgOrderValue = totalSales / totalOrders;

            document.getElementById('totalSales').innerText = `$${totalSales.toLocaleString()}`;
            document.getElementById('totalOrders').innerText = totalOrders;
            document.getElementById('avgOrderValue').innerText = `$${avgOrderValue.toFixed(2)}`;

            // 2. Group data for charts and tables
            const salesByCategory = {};
            const salesByRegion = {};
            const monthlySales = {};
            const productsData = {};
            const customersData = {};
            
            const monthNames = ["يناير", "فبراير", "مارس", "أبريل", "مايو", "يونيو", "يوليو", "أغسطس", "سبتمبر", "أكتوبر", "نوفمبر", "ديسمبر"];

            salesData.forEach(item => {
                const orderDate = new Date(item.OrderDate);
                const monthYear = `${orderDate.getFullYear()}-${orderDate.getMonth() + 1}`;
                const monthLabel = `${monthNames[orderDate.getMonth()]} ${orderDate.getFullYear()}`;

                // Sales by Category
                salesByCategory[item.Category] = (salesByCategory[item.Category] || 0) + item.TotalSales;

                // Sales by Region
                salesByRegion[item.Region] = (salesByRegion[item.Region] || 0) + item.TotalSales;

                // Monthly Sales
                if (!monthlySales[monthYear]) {
                    monthlySales[monthYear] = { label: monthLabel, totalSales: 0 };
                }
                monthlySales[monthYear].totalSales += item.TotalSales;

                // Products Data
                if (!productsData[item.Product]) {
                    productsData[item.Product] = { totalSales: 0, totalQuantity: 0 };
                }
                productsData[item.Product].totalSales += item.TotalSales;
                productsData[item.Product].totalQuantity += item.Quantity;

                // Customers Data
                if (!customersData[item.CustomerName]) {
                    customersData[item.CustomerName] = { totalSpending: 0, orderCount: 0 };
                }
                customersData[item.CustomerName].totalSpending += item.TotalSales;
                customersData[item.CustomerName].orderCount += 1;
            });

            // 3. Prepare data for charts and tables
            const categories = Object.keys(salesByCategory);
            const categorySales = Object.values(salesByCategory);
            const regions = Object.keys(salesByRegion);
            const regionSales = Object.values(salesByRegion);
            const monthlyLabels = Object.values(monthlySales).map(m => m.label);
            const monthlyData = Object.values(monthlySales).map(m => m.totalSales);


            // 4. Create charts using Chart.js
            createBarChart('salesByCategoryChart', categories, categorySales, 'المبيعات ($)', 'المبيعات حسب الفئة');
            createBarChart('salesByRegionChart', regions, regionSales, 'المبيعات ($)', 'المبيعات حسب المنطقة');
            createBarChart('monthlySalesChart', monthlyLabels, monthlyData, 'المبيعات ($)', 'المبيعات الشهرية');


            // 5. Populate Top Products Table
            const sortedProducts = Object.entries(productsData)
                .sort(([, a], [, b]) => b.totalSales - a.totalSales)
                .slice(0, 5);

            const tableBodyProducts = document.getElementById('topProductsTable');
            tableBodyProducts.innerHTML = ''; // Clear previous data
            sortedProducts.forEach(([product, data]) => {
                const row = document.createElement('tr');
                row.className = 'border-b hover:bg-gray-100';
                row.innerHTML = `
                    <td class="py-3 px-6 text-right">${product}</td>
                    <td class="py-3 px-6 text-right">$${data.totalSales.toLocaleString()}</td>
                    <td class="py-3 px-6 text-right">${data.totalQuantity}</td>
                `;
                tableBodyProducts.appendChild(row);
            });

            // 6. Populate Top Customers Table
            const sortedCustomers = Object.entries(customersData)
                .sort(([, a], [, b]) => b.totalSpending - a.totalSpending)
                .slice(0, 5);

            const tableBodyCustomers = document.getElementById('topCustomersTable');
            tableBodyCustomers.innerHTML = ''; // Clear previous data
            sortedCustomers.forEach(([customer, data]) => {
                const row = document.createElement('tr');
                row.className = 'border-b hover:bg-gray-100';
                row.innerHTML = `
                    <td class="py-3 px-6 text-right">${customer}</td>
                    <td class="py-3 px-6 text-right">$${data.totalSpending.toLocaleString()}</td>
                    <td class="py-3 px-6 text-right">${data.orderCount}</td>
                `;
                tableBodyCustomers.appendChild(row);
            });

        }

        // Helper function to create a bar chart
        function createBarChart(canvasId, labels, data, yLabel, chartTitle) {
            const ctx = document.getElementById(canvasId).getContext('2d');
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: yLabel,
                        data: data,
                        backgroundColor: [
                            'rgba(75, 192, 192, 0.6)',
                            'rgba(153, 102, 255, 0.6)',
                            'rgba(255, 159, 64, 0.6)',
                            'rgba(255, 99, 132, 0.6)',
                            'rgba(54, 162, 235, 0.6)'
                        ],
                        borderColor: [
                            'rgba(75, 192, 192, 1)',
                            'rgba(153, 102, 255, 1)',
                            'rgba(255, 159, 64, 1)',
                            'rgba(255, 99, 132, 1)',
                            'rgba(54, 162, 235, 1)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        title: {
                            display: true,
                            text: chartTitle,
                            font: { size: 16 }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        // Run the analysis when the page loads
        window.onload = runAnalysis;

    </script>
</body>
</html>